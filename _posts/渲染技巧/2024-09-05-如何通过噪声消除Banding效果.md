---
layout: post
title: 【Learning Notes】Banding in Games - A Noisy Rant
date: 2024-09-05
img: Dithering-avoids-banding/1.png # Add image post (optional)
fig-caption: # Add figcaption (optional)
tags: [Banding, Noise, Dithering]
---
今天给大家分享的是一种通过噪声+Dither来消除banding异常的方法，该方法的作者是Playdead工作室（开发过广受好评的游戏《地狱边境》与《Inside》）的Mikkel Gjøl，原文可以在参考链接中找到。

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/2.png)

这是pixeljunk eden的一个截图

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/3.png)

通过调整整张图的明暗对比度，我们会发现图片会逐渐呈现色块化。

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/4.png)

上古卷轴，大家印象深刻的是场景里的内容

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/5.png)

不过这里关注的是菜单界面的banding问题

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/6.png)

同样做下对比度的缩放

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/7.png)

kentucky route zero是另一款非常有趣的游戏

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/8.png)

也存在同样的问题

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/9.png)

这里粗略的展示了一帧的渲染管线，对显示器而言，其希望得到的输入贴图是sRGB（standard RGB，提供一种标准方法来定义色彩，让显示、打印和扫描等计算机外部设备与应用软件对于色彩有一个共通的语言，非线性空间）的，而为了保障输入贴图的精度，就得做到：

1. 要么单个通道的位数高于8（从而提供更高的精度，保留精度冗余）
2. 要么上述所有环节输出的颜色都是处于sRGB空间的

而实际上我们不太可能提高贴图输出的位数，另外，要保证每个环节的输出结果符合标准也比较困难，会有各种原因导致这个的失败，比如我们的framebuffer通常默认是线性空间的（计算逻辑通常都是线性空间），如果想将之转换到sRGB空间（比如通过OpenGL的[framebuffer_sRGB](http://www.opengl.org/registry/specs/ARB/framebuffer_sRGB.txt)），就会有计算上的额外消耗，此外从sRGB的framebuffer读取结果并与当前color混合后的结果不一定还处于sRGB空间。

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/10.png)

如果gamma设置不正确就容易出现前面的banding问题，但是考虑到各种因素的存在，想要把gamma设定正确也不容易（RTT是render to texture的缩写）。

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/11.png)

先来回顾一下sRGB的相关概念

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/12.png)

建议先看看这篇文章：[Gamefest 2007: Picture Perfect: Gamma Through the Rendering Pipeline](http://loopit.dk/Gamma_Through_the_Rendering_Pipeline.zip)，这篇文章给出了gamma的前因后果描述，并给出了实践过程中的一些指导建议。

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/ref1.png)

1. 基色贴图由于需要直接查看效果，在显示器的gamma矫正下，为了保证结果的准确，需要在编辑与保存的时候采用sRGB
   1. 还有利于存储暗部细节（人眼对光的感知是非线性的，感受的是相对亮度，而非绝对亮度，相当于开了一个系数为1/2.2的gamma矫正）
2. 其他类型贴图，如果单通道位数高于8，有精度冗余，可以考虑用sRGB（后续计算需要转回线性，此处会有精度损失），否则用线性
3. shader计算应该在线性空间中完成，否则计算结果会不正确
4. shader计算完成准备写入到framebuffer的时候，需要转换回sRGB，framebuffer也应该使用sRGB格式
   1. 这里会导致blending存在一些问题，为了避免这类问题，建议采用HDR的framebuffer
      1. 可以采用线性空间进行数据存储，不用担心精度问题，且混合结果符合预期
      2. 有足够的精度存储暗部
5. 更多HDR的信息参考下图

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/ref2.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/13.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/14.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/15.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/16.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/17.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/18.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/19.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/20.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/21.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/22.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/23.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/24.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/25.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/26.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/27.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/28.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/29.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/30.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/31.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/32.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/33.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/34.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/35.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/36.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/37.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/38.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/39.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/40.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/41.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/42.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/43.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/44.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/45.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/46.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/47.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/48.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/49.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/50.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/51.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/52.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/53.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/54.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/55.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/56.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/57.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/58.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/59.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/60.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/61.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/62.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/63.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/64.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/65.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/66.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/67.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/68.png)

![](https://gerigory.github.io/assets/img/Dithering-avoids-banding/69.png)



## 参考

[[1]. Banding in Games:A Noisy Rant](http://loopit.dk/banding_in_games.pdf)
